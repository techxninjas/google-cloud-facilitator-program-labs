gcloud config set run/region us-central1 && mkdir gcf_hello_world && cd gcf_hello_world && echo "const functions = require('@google-cloud/functions-framework');\n\nfunctions.cloudEvent('helloPubSub', cloudEvent => {\n  const base64name = cloudEvent.data.message.data;\n  const name = base64name ? Buffer.from(base64name, 'base64').toString() : 'World';\n  console.log(\`Hello, \${name}!\`);\n});" > index.js && echo '{\n  "name": "gcf_hello_world",\n  "version": "1.0.0",\n  "main": "index.js",\n  "scripts": {\n    "start": "node index.js",\n    "test": "echo \\"Error: no test specified\\" && exit 1"\n  },\n  "dependencies": {\n    "@google-cloud/functions-framework": "^3.0.0"\n  }\n}' > package.json && npm install && gcloud functions deploy nodejs-pubsub-function --gen2 --runtime=nodejs20 --region=us-central1 --source=. --entry-point=helloPubSub --trigger-topic=cf-demo --stage-bucket=qwiklabs-gcp-01-3b64dfc861cc-bucket --service-account=cloudfunctionsa@qwiklabs-gcp-01-3b64dfc861cc.iam.gserviceaccount.com --allow-unauthenticated
